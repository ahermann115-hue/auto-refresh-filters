name: Weekly Filter Update

on:
  schedule:
    - cron: '0 0 * * *'  # –ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ –ø–æ–ª–Ω–æ—á—å
  workflow_dispatch:      # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.AUTO_UPDATE_TOKEN }}
          ref: main

      - name: üêç Setup Python
        run: |
          python3 --version
          echo "Python –≥–æ—Ç–æ–≤"

      - name: üîß Setup permissions
        run: |
          chmod +x update.sh
          echo "–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω: ${{ secrets.AUTO_UPDATE_TOKEN != '' }}"

      - name: üöÄ Run update script
        run: ./update.sh

      - name: üìù Commit and Push Files
        env:
          GH_TOKEN: ${{ secrets.AUTO_UPDATE_TOKEN }}
        run: |
          # –ü—Ä–æ—Å—Ç–µ–π—à–∞—è –≤–µ—Ä—Å–∏—è - —Ç–æ–ª—å–∫–æ –∫–æ–º–º–∏—Ç
          echo "üîÑ –ù–∞—á–∏–Ω–∞–µ–º –∫–æ–º–º–∏—Ç..."
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã
          echo "üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
          ls -lh blacklist.*
          
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º git
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          
          # –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –í–°–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è
          git add -A
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
          echo "üìä –°—Ç–∞—Ç—É—Å git:"
          git status --short
          
          # –ö–æ–º–º–∏—Ç–∏–º –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if ! git diff --cached --quiet; then
            echo "üíæ –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç..."
            git commit -m "ü§ñ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ $(date +'%Y-%m-%d %H:%M')
            
            ‚Ä¢ TXT: 295,431 –¥–æ–º–µ–Ω–æ–≤
            ‚Ä¢ BIN: 1,000 –¥–æ–º–µ–Ω–æ–≤ (—Ç–µ—Å—Ç)"
            
            echo "üöÄ –ü—É—à–∏–º..."
            git push "https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git" HEAD:main
            
            echo "‚úÖ –£–°–ü–ï–•! –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã."
          else
            echo "‚ÑπÔ∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          fi
          
          echo "üéâ –†–ê–ë–û–¢–ê –ó–ê–í–ï–†–®–ï–ù–ê"

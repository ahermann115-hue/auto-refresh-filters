name: Weekly Filter Update

on:
  schedule:
    - cron: '0 0 * * 0'  # –ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 00:00 UTC
  workflow_dispatch:      # –†–∞–∑—Ä–µ—à–∏—Ç—å —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
      # –®–ê–ì 1: Checkout —Å –í–ê–®–ò–ú —Ç–æ–∫–µ–Ω–æ–º (—ç—Ç–æ –∫–ª—é—á–µ–≤–æ–µ!)
      - name: üì• Checkout with PAT
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.AUTO_UPDATE_TOKEN }}  # –¢–û–õ–¨–ö–û –≤–∞—à —Ç–æ–∫–µ–Ω
          ref: main

      # –®–ê–ì 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
      - name: üîß Setup
        run: |
          chmod +x update.sh
          echo "–¢–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${{ secrets.AUTO_UPDATE_TOKEN != '' }}"
          echo "–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"
          ls -la

      # –®–ê–ì 3: –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
      - name: üöÄ Run update script
        run: ./update.sh

      # –®–ê–ì 4: –ö–æ–º–º–∏—Ç –∏ –ø—É—à —Å –¢–ï–ú –ñ–ï —Ç–æ–∫–µ–Ω–æ–º
      - name: üìù Commit and Push
        env:
          GH_TOKEN: ${{ secrets.AUTO_UPDATE_TOKEN }}  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ —Ç–æ–∫–µ–Ω
        run: |
          # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º git
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if [[ -n "$(git status --porcelain)" ]]; then
            echo "–ï—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ–º–º–∏—Ç–∏–º..."
            git add blacklist.txt
            git commit -m "ü§ñ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ $(date +'%Y-%m-%d %H:%M:%S')"
            
            # –ü—É—à–∏–º –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
            git push "https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git" HEAD:main
            echo "‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—à–∏–ª–∏!"
          else
            echo "‚ÑπÔ∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          fi
